# Документация по NestJS и проекту Assets Monitoring Backend

## Общие принципы NestJS

### Что такое NestJS?

NestJS - это прогрессивный фреймворк для Node.js, построенный на принципах объектно-ориентированного программирования, функционального программирования и функционального реактивного программирования. Он использует TypeScript как основной язык разработки и вдохновлен Angular.

### Модульная архитектура

NestJS построен на модульной архитектуре, где приложение разбивается на независимые модули. Каждый модуль инкапсулирует связанную функциональность:

- **Модули** (`@Module`) - контейнеры для организации кода, группируют контроллеры, сервисы и другие компоненты
- **Контроллеры** (`@Controller`) - обрабатывают HTTP запросы и возвращают ответы
- **Сервисы** (`@Injectable`) - содержат бизнес-логику приложения
- **Провайдеры** - компоненты, которые могут быть инжектированы (сервисы, репозитории, фабрики и т.д.)

### Dependency Injection (Внедрение зависимостей)

NestJS использует мощную систему dependency injection:

- Компоненты не создают свои зависимости самостоятельно
- Зависимости предоставляются контейнером через конструктор
- Это обеспечивает слабую связанность и легкость тестирования
- Декоратор `@Injectable()` регистрирует класс как провайдер

### Декораторы

NestJS heavily использует декораторы для метаданных:

- `@Module()` - определяет модуль и его компоненты
- `@Controller()` - регистрирует класс как контроллер с путем
- `@Get()`, `@Post()`, `@Put()`, `@Delete()` - определяют HTTP маршруты
- `@Injectable()` - делает класс доступным для dependency injection
- `@Entity()` - отмечает класс как сущность базы данных
- `@Column()` - определяет столбцы в таблице

### Жизненный цикл приложения

1. **Bootstrap** - запуск приложения в `main.ts`
2. **Инициализация модулей** - NestJS создает экземпляры модулей
3. **Dependency injection** - разрешение и инжекция зависимостей
4. **Регистрация маршрутов** - настройка HTTP маршрутов из контроллеров
5. **Запуск сервера** - приложение начинает прослушивать запросы

### Создание компонентов

#### Модуль

```typescript
@Module({
  imports: [], // Другие модули
  controllers: [], // Контроллеры
  providers: [], // Сервисы и провайдеры
  exports: [], // Экспортируемые провайдеры
})
export class MyModule {}
```

#### Контроллер

```typescript
@Controller('path')
export class MyController {
  constructor(private service: MyService) {}

  @Get()
  findAll() {
    return this.service.findAll();
  }
}
```

#### Сервис

```typescript
@Injectable()
export class MyService {
  findAll(): Promise<Item[]> {
    // Бизнес-логика
  }
}
```

## Структура проекта Assets Monitoring Backend

### Обзор архитектуры

Проект представляет собой REST API для мониторинга финансовых активов, построенный на NestJS с использованием:

- **TypeORM** - ORM для работы с базой данных SQLite
- **JWT** - аутентификация и авторизация
- **class-validator** - валидация входных данных
- **bcrypt** - хэширование паролей

### Модули приложения

#### 1. Корневой модуль (`AppModule`)

**Файл:** `src/app.module.ts`

Главный модуль приложения, который:

- Импортирует все функциональные модули (Assets, Auth, Notifications)
- Настраивает глобальную базу данных через TypeORM
- Определяет корневую конфигурацию приложения

#### 2. Модуль активов (`AssetsModule`)

**Файлы:**

- `src/assets/assets.module.ts` - определение модуля
- `src/assets/asset.entity.ts` - сущность актива
- `src/assets/assets.controller.ts` - REST API для активов
- `src/assets/assets.service.ts` - бизнес-логика активов
- `src/assets/dto/create-asset.dto.ts` - DTO для создания
- `src/assets/dto/update-asset.dto.ts` - DTO для обновления

**Функциональность:**

- CRUD операции над финансовыми активами
- Валидация данных через DTO
- Работа с базой данных через TypeORM

**API endpoints:**

- `GET /assets` - получить все активы
- `GET /assets/:id` - получить актив по ID
- `POST /assets` - создать новый актив
- `PUT /assets/:id` - обновить актив
- `DELETE /assets/:id` - удалить актив

#### 3. Модуль аутентификации (`AuthModule`)

**Файлы:**

- `src/auth/auth.module.ts` - определение модуля
- `src/auth/user.entity.ts` - сущность пользователя
- `src/auth/auth.controller.ts` - API для аутентификации
- `src/auth/auth.service.ts` - логика аутентификации
- `src/auth/jwt.strategy.ts` - JWT стратегия
- `src/auth/dto/register.dto.ts` - DTO для регистрации
- `src/auth/dto/login.dto.ts` - DTO для входа

**Функциональность:**

- Регистрация новых пользователей
- Аутентификация и генерация JWT токенов
- Хэширование паролей с bcrypt
- Валидация JWT токенов через Passport стратегию

**API endpoints:**

- `POST /auth/register` - регистрация пользователя
- `POST /auth/login` - вход в систему

#### 4. Модуль уведомлений (`NotificationsModule`)

**Файлы:**

- `src/notifications/notifications.module.ts` - определение модуля
- `src/notifications/notifications.controller.ts` - API для уведомлений
- `src/notifications/notifications.service.ts` - логика уведомлений
- `src/notifications/dto/send-notification.dto.ts` - DTO для отправки

**Функциональность:**

- Отправка уведомлений пользователям
- В текущей реализации - placeholder для будущей интеграции с email/SMS сервисами

**API endpoints:**

- `POST /notifications/send` - отправить уведомление

### Точка входа

**Файл:** `src/main.ts`

Основной файл приложения, который:

- Создает экземпляр NestJS приложения
- Включает CORS для взаимодействия с фронтендом
- Запускает сервер на порту 3000

### База данных

Приложение использует SQLite базу данных с файлом `database.sqlite`. TypeORM автоматически создает таблицы на основе сущностей при запуске (synchronize: true). В продакшене рекомендуется использовать миграции.

### Сущности базы данных

#### Asset (Активы)

- `id` - первичный ключ (автоинкремент)
- `name` - название актива
- `symbol` - торговая символ
- `price` - цена (decimal)
- `type` - тип актива (stock, crypto, etc.)

#### User (Пользователи)

- `id` - первичный ключ (автоинкремент)
- `email` - email (уникальный)
- `password` - хэшированный пароль
- `role` - роль пользователя (user, admin)

### Безопасность

- Пароли хэшируются с помощью bcrypt (10 раундов)
- JWT токены используются для аутентификации
- Токены истекают через 60 минут
- Валидация входных данных через class-validator

### Запуск приложения

```bash
npm install
npm run start:dev  # Для разработки
npm run build && npm run start:prod  # Для продакшена
```

Сервер будет доступен на `http://localhost:3000`

### Дальнейшее развитие

Проект может быть расширен:

- Добавление guards для авторизации
- Интеграция с реальными API для получения цен активов
- Реализация отправки email уведомлений
- Добавление ролей и разрешений
- Мониторинг и логирование
- Тестирование (unit и e2e)
