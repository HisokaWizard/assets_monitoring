# Конституция для /speckit.constitution

Этот документ описывает все ограничения и спецификации для проекта assets_monitoring, enforced командой /speckit.constitution. Он определяет архитектурные ограничения, стек технологий и операционные руководства для обеспечения наглядности и поддерживаемости.

## Обзор проекта

Сервис assets_monitoring предназначен для мониторинга рынков, выполнения математических операций, запросов к открытым API бирж, обновления данных и управления инвестиционными портфелями пользователей. Он состоит из backend сервера, frontend клиента и базы данных, предназначен для запуска на Raspberry Pi 4.

## Ограничения стека технологий

### Backend (Сервер)

- **Runtime**: Node.js
- **Язык**: TypeScript (строгий режим, использование `any` запрещено)
- **Инструмент сборки**: Webpack 5
- **Фреймворк**: NestJS (выбран за модульную архитектуру, встроенную инъекцию зависимостей и сильную поддержку enterprise-фич вроде аутентификации, валидации и документации API)
- **Ключевые возможности**:
  - Обработка всех запросов и API к биржам
  - Выполнение математических вычислений
  - Отдача статических файлов для frontend
  - Реализация аутентификации и авторизации
- **Ограничения**:
  - Запрет на использование `any` в TypeScript
  - Весь код должен быть строго типизирован
  - Модульная структура с контроллерами, сервисами и модулями

### Frontend (Клиент)

- **Фреймворк**: React
- **Язык**: TypeScript (строгий режим, использование `any` запрещено)
- **Инструмент сборки**: Webpack 5
- **UI Фреймворк**: Material-UI (MUI) для компонентов вроде таблиц, страниц, инпутов и т.д.
- **Роутинг**: React Router для клиентской навигации
- **Ключевые возможности**:
  - Визуализация данных и портфеля
  - Редактирование портфеля с вкладками (фонды, токены, NFT)
  - Пользовательские вкладки с шаблонами
- **Ограничения**:
  - Запрет на использование `any` в TypeScript
  - Компонентная архитектура
  - Адаптивный дизайн с использованием MUI

### База данных

- **Тип**: Реляционная SQL база данных
- **Реализация**: SQLite (выбрана за легковесность, низкое потребление ресурсов для Raspberry Pi 4, достаточна для малого объема данных)
- **Ограничения**:
  - Использовать ORM: TypeORM (хорошо интегрируется с NestJS и TypeScript)
  - Миграции схемы для контроля версий
  - Запрет на прямые SQL запросы; использовать ORM для всех взаимодействий

### Аутентификация и авторизация

- **Фреймворк**: Passport.js с JWT стратегией (интегрировано в NestJS)
- **Возможности**:
  - Регистрация и вход пользователей
  - Ролевая модель доступа (например, роли для управления портфелем)
  - Безопасное хранение и валидация токенов
- **Ограничения**:
  - Хэширование паролей с bcrypt
  - Истечение JWT и refresh токены
  - Запрет на хранение чувствительных данных в plain text

## DevOps и развертывание

- **Контейнеризация**: Docker для упаковки приложения
- **Оркестрация**: Kubernetes (опционально для масштабирования, но рассмотреть для будущих нужд; для одного Pi4 может хватить Docker Compose)
- **Reverse Proxy**: Nginx для балансировки нагрузки, SSL termination и отдачи статических файлов
- **CI/CD Pipeline**:
  - Использовать Git для контроля версий
  - GitHub Actions или аналог для автоматизированного тестирования, сборки и развертывания
  - Сборка и развертывание на Raspberry Pi 4
- **Ограничения**:
  - Все развертывания должны быть контейнеризированы
  - Конфигурации для сред (dev, prod)
  - Мониторинг и логирование с инструментами вроде Winston для NestJS

## Операционные руководства

- **Обработка данных**: Все обновления данных рынка через запланированные задачи (например, с использованием NestJS schedulers)
- **Интеграции API**: Безопасная обработка API бирж с rate limiting и обработкой ошибок
- **Безопасность**: Принудительный HTTPS, валидация ввода, конфигурация CORS
- **Производительность**: Оптимизация для низкоресурсной среды (Raspberry Pi 4); кэширование часто запрашиваемых данных
- **Масштабируемость**: Дизайн с учетом потенциального будущего масштабирования, но приоритет простоте для начального развертывания

## Применение

Эта конституция применяется командой /speckit.constitution. Любой код или конфигурация, нарушающая эти ограничения, должна быть рефакторирована для соответствия. Использовать spec-kit для начального дизайна и ongoing валидации.

## Версия

v1.0 - Начальная конституция на основе требований проекта.
